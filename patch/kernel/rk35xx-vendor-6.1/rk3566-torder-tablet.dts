// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
/*
 * Copyright (c) 2025 Serhii Serhieiev <adron@ngnp.net>
 */
/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/pinctrl/rockchip.h>
#include <dt-bindings/input/rk-input.h>
#include <dt-bindings/sensor-dev.h>
#include <dt-bindings/display/drm_mipi_dsi.h>
#include "rk3566.dtsi"
#include "rk3568-android.dtsi"


/ {
	model = "Torder tablet";
	compatible = "torder,tablet", "rockchip,rk3566";

	aliases {
		mmc0 = &sdmmc0;
		mmc1 = &sdmmc1;
		mmc2 = &sdhci;
	};

	chosen: chosen {
		bootargs = "earlycon=uart8250,mmio32,0xfe660000 console=ttyFIQ0 root=PARTUUID=614e0000-0000 rw rootwait";
	};

	adc-keys {
		compatible = "adc-keys";
		io-channels = <&saradc 0>;
		io-channel-names = "buttons";
		keyup-threshold-microvolt = <1800000>;
		poll-interval = <100>;

		vol-up-key {
			label = "volume-up";
			linux,code = <KEY_VOLUMEUP>;
			press-threshold-microvolt = <297500>;
		};
		vol-down-key {
			label = "volume-down";
			linux,code = <KEY_VOLUMEDOWN>;
			press-threshold-microvolt = <1750>;
		};
	};


	backlight: backlight {
		compatible = "pwm-backlight";
		power-supply = <&vcc3v3_sys>;
		pwms = <&pwm14 0 25000 0>;
		brightness-levels = <
			0		20	20	21	21	22	22	23
			23	24	24	25	25	26	26	27
			27	28	28	29	29	30	30	31
			31	32	32	33	33	34	34	35
			35	36	36	37	37	38	38	39
			40	41	42	43	44	45	46	47
			48	49	50	51	52	53	54	55
			56	57	58	59	60	61	62	63
			64	65	66	67	68	69	70	71
			72	73	74	75	76	77	78	79
			80	81	82	83	84	85	86	87
			88	89	90	91	92	93	94	95
			96	97	98	99	100	101	102	103
			104	105	106	107	108	109	110	111
			112	113	114	115	116	117	118	119
			120	121	122	123	124	125	126	127
			128	129	130	131	132	133	134	135
			136	137	138	139	140	141	142	143
			144	145	146	147	148	149	150	151
			152	153	154	155	156	157	158	159
			160	161	162	163	164	165	166	167
			168	169	170	171	172	173	174	175
			176	177	178	179	180	181	182	183
			184	185	186	187	188	189	190	191
			192	193	194	195	196	197	198	199
			200	201	202	203	204	205	206	207
			208	209	210	211	212	213	214	215
			216	217	218	219	220	221	222	223
			224	225	226	227	228	229	230	231
			232	233	234	235	236	237	238	239
			240	241	242	243	244	245	246	247
			248	249	250	251	252	253	254	255>;
		default-brightness-level = <128>;
	};

	sound {
		compatible = "simple-audio-card";
		pinctrl-0 = <&hp_det>;
		pinctrl-names = "default";
		simple-audio-card,name = "rk817_ext";
		simple-audio-card,aux-devs = <&spk_amp>;
		simple-audio-card,format = "i2s";
		simple-audio-card,hp-det-gpio = <&gpio3 RK_PA1 GPIO_ACTIVE_LOW>;
		simple-audio-card,mclk-fs = <256>;
		simple-audio-card,widgets =
			"Microphone", "Internal Mic",
			"Microphone", "Mic Jack",
			"Headphone", "Headphones",
			"Speaker", "Internal Speakers";
		simple-audio-card,routing =
			/* Internal mic */
			"MICL", "Internal Mic",
			/* External mic (e.g. headset) */
			"MICL", "Mic Jack",

			/* Headphones */
			"Headphones", "HPOL",
			"Headphones", "HPOR",

	    /* Speaker amp path */
			"Speaker Amp INL", "HPOL",
			"Speaker Amp INR", "HPOR",
			"Internal Speakers", "Speaker Amp OUTL",
			"Internal Speakers", "Speaker Amp OUTR";
		simple-audio-card,pin-switches = "Internal Speakers";
		simple-audio-card,jack-second-pin = "Internal Speakers";

		simple-audio-card,codec {
			sound-dai = <&rk817>;
		};

		simple-audio-card,cpu {
			sound-dai = <&i2s1_8ch>;
		};
	};

	spk_amp: audio-amplifier {
		compatible = "simple-audio-amplifier";
		enable-gpios = <&gpio3 RK_PA2 GPIO_ACTIVE_HIGH>;
		pinctrl-0 = <&spk_amp_enable_h>;
		pinctrl-names = "default";
		sound-name-prefix = "Speaker Amp";
		VCC-supply = <&vcc_3v3>;
	};

	bt_sco: bt-sco {
		/* Bluetooth-SCO (Synchronous Connection-Oriented link) audio CODEC */
		compatible = "delta,dfbmcs320";
		#sound-dai-cells = <0>;
		status = "okay";
	};

	bt-sound {
		compatible = "simple-audio-card";
		simple-audio-card,format = "dsp_b";
		simple-audio-card,bitclock-inversion = <1>;
		simple-audio-card,mclk-fs = <256>;
		simple-audio-card,name = "rockchip,bt";
		simple-audio-card,bitclock-master = <&bt_sco>;
		simple-audio-card,frame-master = <&bt_sco>;
		simple-audio-card,widgets =
			"Microphone", "RX",
			"Speaker", "TX";
		simple-audio-card,routing =
			"BT_SCO_TX", "RX",
			"TX", "BT_SCO_RX";

		simple-audio-card,codec {
			sound-dai = <&bt_sco>;
		};

		simple-audio-card,cpu {
			sound-dai = <&i2s2_2ch>;
		};

	};

	sdio_pwrseq: sdio-pwrseq {
		compatible = "mmc-pwrseq-simple";
		clocks = <&rk817 1>;
		clock-names = "ext_clock";
		//pinctrl-names = "default";
		//pinctrl-0 = <&wifi_enable_h>;
		//reset-gpios = <&gpio0 RK_PC0 GPIO_ACTIVE_LOW>; // chip_en (wl-reg-on)
		/* The UWE driver is responsible for reset control. Otherwise, the card detection does not pass. */
	};

	sprd-wlan {
		compatible = "sprd,uwe5622-wifi";
		status = "okay";
	};

	sprd-mtty {
		compatible = "sprd,mtty";
		sprd,name = "ttyBT";
		status = "okay";
	};

	uwe-bsp {
		// Think of the BSP as the glue between the Linux kernel and the hardware — it ensures the UWE5621DS can initialize,
		// communicate, and function properly on your board. Without it, the kernel won’t know how to talk to the chip,
		// even if the hardware is present.
		compatible = "unisoc,uwe_bsp";
		wl-reg-on = <&gpio0 RK_PC0 GPIO_ACTIVE_HIGH>;
		bt-reg-on = <&gpio0 RK_PC1 GPIO_ACTIVE_HIGH>;
		sdio-ext-int-gpio = <&gpio0 RK_PC3 GPIO_ACTIVE_HIGH>;
		unisoc,btwf-file-name = "/lib/firmware/uwe5622/wcnmodem.bin";
		bt-wake-host;
		bt-wake-host-gpio = <&gpio0 RK_PB7 GPIO_ACTIVE_HIGH>;
		blksz-512;
		keep-power-on;
		//data-irq;
		sdma-tx;
		sdma-rx;
		status = "okay";
	};

	// battery: battery {
	// 	compatible = "simple-battery";
	// 	charge-full-design-microamp-hours = <6000000>;
	// 	charge-term-current-microamp = <300000>;
	// 	constant-charge-current-max-microamp = <2000000>;
	// 	constant-charge-voltage-max-microvolt = <4300000>;
	// 	voltage-max-design-microvolt = <4138000>;
	// 	voltage-min-design-microvolt = <3400000>;

	// 	ocv-capacity-celsius = <20>;
	// 	ocv-capacity-table-0 =  <4138000 100>, <4083000 95>, <4059000 90>, <4044000 85>,
	// 				<4030000 80>, <4020000 75>, <4006000 70>, <3972000 65>,
	// 				<3934000 60>, <3904000 55>, <3878000 50>, <3857000 45>,
	// 				<3843000 40>, <3826000 35>, <3801000 30>, <3768000 25>,
	// 				<3735000 20>, <3688000 15>, <3621000 10>, <3553000 5>,
	// 				<3400000 0>;
	// 	ntc-table = <45067 42950 40946 39048 37251 35548 33934 32403 30952 29574 28267 27025 25846 24726 23661 22649 21686 20771 19899 19070 18280 17527 16810 16127 15476 14855 14262 13697 13157 12642 12150 11680 11231 10802 10392 10000 9624 9265 8922 8593 8278 7977 7688 7411 7146 6890 6643 6408 6182 5965 5756 5554 5361 5175 4996 4824 4658 4497 4341 4192 4047 3908 3775 3647 3524 3406 3292 3183 3077 2977 2878 2782 2694 2607 2526 2448 2373 2302 2234 2169 2108 2049 1993 1940 1888 1838 1792 1746 1702 1659 1636>;
	// };

	/* hdmi-con {
		compatible = "hdmi-connector";
		type = "c";

		port {
			hdmi_con_in: endpoint {
				remote-endpoint = <&hdmi_out_con>;
			};
		};
	}; */

	battery: battery {
        compatible = "rockchip,rk817-battery";

        /* OCV Table: 0% ~ 100% (one point every 5%, total 21 points) */
        /* Voltage range: 3400mV → 4399mV, suitable for 4.4V high-voltage Li-ion cells */
        ocv_table = <3400 3450 3500 3550 3600 3650 3700
                     3750 3800 3850 3900 3950 3999 4049
                     4099 4141 4199 4249 4299 4341 4399>;

        design_capacity = <6074>;     /* Design capacity: 6074 mAh */
        design_qmax = <6681>;         /* Maximum available capacity (new cell): 6681 mAh */

        sample_res = <10>;            /* Sense resistor: 10 mΩ (critical driver parameter) */

        sleep_enter_current = <150>;  /* Enter sleep when current < 150 mA */
        sleep_exit_current  = <180>;  /* Exit sleep when current > 180 mA */
        sleep_filter_current = <100>; /* Current filter threshold */

        power_off_threshold = <3400>; /* Power-off voltage: 3.40V (to prevent over-discharge) */
        zero_algorithm_vol = <3950>;  /* Enable high-SOC optimization when ≥ 3.95V */
        max_soc_offset = <60>;        /* Max SOC deviation: 6% triggers calibration */
        monitor_sec = <5>;            /* Monitoring period: update every 5 seconds */
        virtual_power = <0>;          /* 0 = real battery, 1 = virtual/simulated */

        /* NTC ADC table (84 points, from low to high temperature) */
        /* Corresponds roughly to -20°C ~ 60°C; adjust to match your circuit */
        ntc_table = <0xb00b 0xa7c6 0x9ff2 0x9888 0x9183 0x8adc 0x848e 0x7e93
                     0x78e8 0x7386 0x6e6b 0x6991 0x64f6 0x6096 0x5c6d 0x5879
                     0x54b6 0x5123 0x4dbb 0x4a7e 0x4768 0x4477 0x41aa 0x3eff
                     0x3c74 0x3a07 0x37b6 0x3581 0x3365 0x3162 0x2f76 0x2da0
                     0x2bdf 0x2a32 0x2898 0x2710 0x2598 0x2431 0x22da 0x2191
                     0x2056 0x1f29 0x1e08 0x1cf3 0x1bea 0x1aeb 0x19f8 0x190e
                     0x182d 0x1756 0x1688 0x15c1 0x1503 0x144c 0x139c 0x12f4
                     0x1251 0x11b5 0x1120 0x108f 0x1005 0xf7f 0xeff 0xe84
                     0xe0d 0xd9a 0xd2c 0xcc2 0xc5b 0xbf9 0xb9a 0xb3e 0xae6
                     0xa91 0xa3f 0x9f0 0x9a3 0x95a 0x912 0x8ce 0x88b 0x84b
                     0x80e 0x7d2 0x798 0x760 0x72a 0x6f6 0x6c4 0x693 0x664>;

        ntc_degree_from = <1 10>;     /* Vendor-specific temperature mapping (for compatibility) */
    };


	vdd_usbc: vdd-usbc-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vdd_usbc";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
	};

	vcc3v3_sys: regulator-vcc3v3-sys {
		compatible = "regulator-fixed";
		regulator-name = "vcc3v3_sys";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc5v0_sys>;
	};

	vcc_lcd: regulator-vcc-lcd {
		compatible = "regulator-fixed";
		regulator-name = "vcc_lcd";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc5v0_sys: regulator-vcc5v0-sys {
		compatible = "regulator-fixed";
		regulator-name = "vcc5v0_sys";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&vdd_usbc>;
	};

	
	vcc5v0_usb_host: regulator-vcc5v0-usb2-host {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio3 RK_PC0 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc5v0_usb_host_en>;
		regulator-name = "vcc5v0_usb2_host";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&vcc5v0_sys>;
	}; 

	
	vcc5v0_usb_otg: regulator-vcc5v0-usb2-otg {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio3 RK_PC0 GPIO_ACTIVE_HIGH>;
		regulator-name = "vcc5v0_usb2_otg";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&dcdc_boost>;
	}; 

	vcc3v3_sd: vcc3v3_sd {
		compatible = "regulator-fixed";
		gpio = <&gpio0 RK_PA5 GPIO_ACTIVE_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc_sd_h>;
		regulator-boot-on;
		regulator-name = "vcc3v3_sd";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc_wifi: regulator-vcc-wifi {
		compatible = "regulator-fixed";
		gpio = <&gpio0 RK_PA0 GPIO_ACTIVE_LOW>;
		pinctrl-0 = <&vcc_wifi_h>;
		pinctrl-names = "default";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-name = "vcc_wifi";
	};

};

&combphy1_usq {
	status = "okay";
};

&combphy2_psq {
	status = "okay";
};

&cpu0 {
	cpu-supply = <&vdd_cpu>;
};

&cpu1 {
	cpu-supply = <&vdd_cpu>;
};

&cpu2 {
	cpu-supply = <&vdd_cpu>;
};

&cpu3 {
	cpu-supply = <&vdd_cpu>;
};

&dsi0 {
	status = "okay";
	#address-cells = <1>;
	#size-cells = <0>;

	dsi_panel: panel@0 {
		status = "okay";
		compatible = "simple-panel-dsi";
		reg = <0>;

		backlight = <&backlight>;
		enable-gpios = <&gpio3 RK_PB1 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&gpio3 RK_PC3 GPIO_ACTIVE_LOW>;

		pinctrl-names = "default";
		pinctrl-0 = <&lcd_rst &lcd_en>;

		power-supply=<&vcc_lcd>;

		enable-delay-ms = <120>;
		prepare-delay-ms = <20>;
		reset-delay-ms = <20>;
		init-delay-ms = <20>;
		unprepare-delay-ms = <20>;
		disable-delay-ms = <20>;

		size,width = <135>;
		size,height = <216>;

		dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM)>;
		dsi,format = <MIPI_DSI_FMT_RGB888>;
		dsi,lanes  = <4>;

		panel-init-sequence = [
			15 00 02 e0 00 15 00 02 e1 93 15 00 02 e2 65 
			15 00 02 e3 f8 15 00 02 80 03 15 00 02 e0 01 
			15 00 02 00 00 15 00 02 01 3c 15 00 02 17 00 
			15 00 02 0c 74 15 00 02 18 af 15 00 02 19 01 
			15 00 02 1a 00 15 00 02 1b af 15 00 02 1c 01 
			15 00 02 1f 3e 15 00 02 20 28 15 00 02 21 28 
			15 00 02 22 7e 15 00 02 35 26 15 00 02 37 09 
			15 00 02 38 04 15 00 02 39 00 15 00 02 3a 01 
			15 00 02 3c 7c 15 00 02 3d ff 15 00 02 3e ff 
			15 00 02 3f 7f 15 00 02 40 06 15 00 02 41 a0 
			15 00 02 42 81 15 00 02 43 08 15 00 02 44 0b 
			15 00 02 45 28 15 00 02 55 02 15 00 02 57 69 
			15 00 02 59 0a 15 00 02 5a 28 15 00 02 5b 14 
			15 00 02 5d 7c 15 00 02 5e 65 15 00 02 5f 55 
			15 00 02 60 47 15 00 02 61 43 15 00 02 62 32 
			15 00 02 63 34 15 00 02 64 1c 15 00 02 65 33 
			15 00 02 66 31 15 00 02 67 30 15 00 02 68 4e 
			15 00 02 69 3c 15 00 02 6a 44 15 00 02 6b 35 
			15 00 02 6c 31 15 00 02 6d 23 15 00 02 6e 11 
			15 00 02 6f 00 15 00 02 70 7c 15 00 02 71 65 
			15 00 02 72 55 15 00 02 73 47 15 00 02 74 43 
			15 00 02 75 32 15 00 02 76 34 15 00 02 77 1c 
			15 00 02 78 33 15 00 02 79 31 15 00 02 7a 30 
			15 00 02 7b 4e 15 00 02 7c 3c 15 00 02 7d 44 
			15 00 02 7e 35 15 00 02 7f 31 15 00 02 80 23 
			15 00 02 81 11 15 00 02 82 00 15 00 02 e0 02 
			15 00 02 00 1e 15 00 02 01 1e 15 00 02 02 41 
			15 00 02 03 41 15 00 02 04 43 15 00 02 05 43 
			15 00 02 06 1f 15 00 02 07 1f 15 00 02 08 35 
			15 00 02 09 1f 15 00 02 0a 15 15 00 02 0b 15 
			15 00 02 0c 1f 15 00 02 0d 47 15 00 02 0e 47 
			15 00 02 0f 45 15 00 02 10 45 15 00 02 11 4b 
			15 00 02 12 4b 15 00 02 13 49 15 00 02 14 49 
			15 00 02 15 1f 15 00 02 16 1e 15 00 02 17 1e 
			15 00 02 18 40 15 00 02 19 40 15 00 02 1a 42 
			15 00 02 1b 42 15 00 02 1c 1f 15 00 02 1d 1f 
			15 00 02 1e 35 15 00 02 1f 1f 15 00 02 20 15 
			15 00 02 21 15 15 00 02 22 1f 15 00 02 23 46 
			15 00 02 24 46 15 00 02 25 44 15 00 02 26 44 
			15 00 02 27 4a 15 00 02 28 4a 15 00 02 29 48 
			15 00 02 2a 48 15 00 02 2b 1f 15 00 02 2c 1f 
			15 00 02 2d 1f 15 00 02 2e 42 15 00 02 2f 42 
			15 00 02 30 40 15 00 02 31 40 15 00 02 32 1e 
			15 00 02 33 1e 15 00 02 34 1f 15 00 02 35 1f 
			15 00 02 36 1e 15 00 02 37 1e 15 00 02 38 1f 
			15 00 02 39 48 15 00 02 3a 48 15 00 02 3b 4a 
			15 00 02 3c 4a 15 00 02 3d 44 15 00 02 3e 44 
			15 00 02 3f 46 15 00 02 40 46 15 00 02 41 1f 
			15 00 02 42 1f 15 00 02 43 1f 15 00 02 44 43 
			15 00 02 45 43 15 00 02 46 41 15 00 02 47 41 
			15 00 02 48 1e 15 00 02 49 1e 15 00 02 4a 1e 
			15 00 02 4b 1f 15 00 02 4c 1e 15 00 02 4d 1e 
			15 00 02 4e 1f 15 00 02 4f 49 15 00 02 50 49 
			15 00 02 51 4b 15 00 02 52 4b 15 00 02 53 45 
			15 00 02 54 45 15 00 02 55 47 15 00 02 56 47 
			15 00 02 57 1f 15 00 02 58 40 15 00 02 5b 30 
			15 00 02 5c 03 15 00 02 5d 30 15 00 02 5e 01 
			15 00 02 5f 02 15 00 02 63 14 15 00 02 64 6a 
			15 00 02 67 73 15 00 02 68 05 15 00 02 69 14 
			15 00 02 6a 6a 15 00 02 6b 08 15 00 02 6c 00 
			15 00 02 6d 06 15 00 02 6e 00 15 00 02 6f 88 
			15 00 02 77 dd 15 00 02 79 0e 15 00 02 7a 03 
			15 00 02 7d 14 15 00 02 7e 6a 15 00 02 e0 04 
			15 00 02 09 11 15 00 02 0e 48 15 00 02 2d 03 
			15 00 02 2b 08 15 00 02 2e 03 15 00 02 e0 00 
			15 00 02 e6 02 15 00 02 e7 0c 
			05 78 01 11 
			05 64 01 29
		];

		panel-exit-sequence = [
			05 01 01 28 
			05 03 01 10
		];

		disp_timings0: display-timings {
			native-mode = <&dsi_timing0>;
			dsi_timing0: timing0 {
				clock-frequency = <60000000>;
				hactive = <800>;
				vactive = <1280>;

				hsync-len = <18>;
				hback-porch = <18>;
				hfront-porch = <18>;

				vsync-len = <4>;
				vback-porch = <8>;
				vfront-porch = <24>;

				hsync-active = <0>;
				vsync-active = <0>;
				de-active = <0>;
				pixelclk-active = <1>;
			};
		};

 		ports {
 			#address-cells = <1>;
 			#size-cells = <0>;
 			port@0 {
 				reg = <0>;
 				panel_in_dsi: endpoint {
 					remote-endpoint = <&dsi_out_panel>;
 				};
 			};
 		};
	};

	ports {
		#address-cells = <1>;
		#size-cells = <0>;
		port@1 {
			reg = <1>;
			dsi_out_panel: endpoint {
				remote-endpoint = <&panel_in_dsi>;
			};
		};
	};
};

&i2c0 {
	status = "okay";

	vdd_cpu: regulator@40 {
		compatible = "silergy,syr827";
		reg = <0x40>;
		regulator-compatible = "fan53555-reg";
		fcs,suspend-voltage-selector = <1>;
		regulator-name = "vdd_cpu";
		regulator-min-microvolt = <712500>;
		regulator-max-microvolt = <1390000>;
		regulator-ramp-delay = <2300>;
		regulator-always-on;
		regulator-boot-on;
		vin-supply = <&vcc5v0_sys>;

		regulator-state-mem {
			regulator-off-in-suspend;
		};
	};

	rk817: pmic@20 {
		compatible = "rockchip,rk817";
		reg = <0x20>;
		interrupt-parent = <&gpio0>;
		interrupts = <RK_PA3 IRQ_TYPE_LEVEL_LOW>;
		clock-output-names = "rk808-clkout1", "rk808-clkout2";
		#clock-cells = <1>;
		pinctrl-names = "default";
		pinctrl-0 = <&pmic_int_l>, <&i2s1m0_mclk>;
		assigned-clocks = <&cru I2S1_MCLKOUT_TX>;
		assigned-clock-parents = <&cru CLK_I2S1_8CH_TX>;
		clock-names = "mclk";
		clocks = <&cru I2S1_MCLKOUT_TX>;
		rockchip,system-power-controller;
		#sound-dai-cells = <0>;
		wakeup-source;

		vcc1-supply = <&vcc3v3_sys>;
		vcc2-supply = <&vcc3v3_sys>;
		vcc3-supply = <&vcc3v3_sys>;
		vcc4-supply = <&vcc3v3_sys>;
		vcc5-supply = <&vcc3v3_sys>;
		vcc6-supply = <&vcc3v3_sys>;
		vcc7-supply = <&vcc3v3_sys>;
		vcc8-supply = <&vcc3v3_sys>;
		vcc9-supply = <&dcdc_boost>;

		regulators {
			vdd_logic: DCDC_REG1 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <500000>;
				regulator-max-microvolt = <1350000>;
				regulator-ramp-delay = <6001>;
				regulator-initial-mode = <0x2>;
				regulator-name = "vdd_logic";
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <900000>;
				};
			};

			vdd_gpu: DCDC_REG2 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <500000>;
				regulator-max-microvolt = <1350000>;
				regulator-ramp-delay = <6001>;
				regulator-initial-mode = <0x2>;
				regulator-name = "vdd_gpu";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vcc_ddr: DCDC_REG3 {
				regulator-always-on;
				regulator-boot-on;
				regulator-initial-mode = <0x2>;
				regulator-name = "vcc_ddr";
				regulator-state-mem {
					regulator-on-in-suspend;
				};
			};

			vcc_3v3: DCDC_REG4 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-initial-mode = <0x2>;
				regulator-name = "vcc_3v3";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vcca1v8_pmu: LDO_REG1 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-name = "vcca1v8_pmu";
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <1800000>;
				};
			};

			vdda_0v9: LDO_REG2 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <900000>;
				regulator-name = "vdda_0v9";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vdda0v9_pmu: LDO_REG3 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <900000>;
				regulator-name = "vdda0v9_pmu";
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <900000>;
				};
			};

			vccio_acodec: LDO_REG4 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-name = "vccio_acodec";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vccio_sd: LDO_REG5 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-name = "vccio_sd";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vcc3v3_pmu: LDO_REG6 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-name = "vcc3v3_pmu";
				regulator-state-mem {
					regulator-on-in-suspend;
					regulator-suspend-microvolt = <3300000>;
				};
			};

			vcc_1v8: LDO_REG7 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-name = "vcc_1v8";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vcc1v8_dvp: LDO_REG8 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-name = "vcc1v8_dvp";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			vcc2v8_dvp: LDO_REG9 {
				regulator-always-on;
				regulator-boot-on;
				regulator-min-microvolt = <2800000>;
				regulator-max-microvolt = <2800000>;
				regulator-name = "vcc2v8_dvp";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			dcdc_boost: BOOST {
				/* regulator-always-on; */
				/* regulator-boot-on; */
				regulator-min-microvolt = <5200000>;
				regulator-max-microvolt = <5400000>;
				regulator-name = "boost";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};

			otg_switch: OTG_SWITCH {
				regulator-name = "otg_switch";
				regulator-state-mem {
					regulator-off-in-suspend;
				};
			};
		};

		// rk817_charger: charger {
		// 	monitored-battery = <&battery>;
		// 	rockchip,resistor-sense-micro-ohms = <10000>;
		// 	rockchip,sleep-enter-current-microamp = <150000>;
		// 	rockchip,sleep-filter-current-microamp = <100000>;
		// };

		rk817_charger: charger {
			compatible = "rk817,charger";
			min_input_voltage = <4500>;
			max_input_current = <1500>;
			max_chrg_current = <2000>;
			max_chrg_voltage = <4300>;
			chrg_term_mode = <0>;
			chrg_finish_cur = <300>;
			virtual_power = <0>;
			dc_det_adc = <0>;
			extcon = <&usb2phy0>;
		};

	};

};

&i2c1 {
	status = "okay";

	ts@40 {
		compatible = "GSL,GSL3673_800X1280";
		reg = <0x40>;
		irq_gpio_number = <&gpio0 RK_PB0 IRQ_TYPE_EDGE_FALLING>;
		rst_gpio_number = <&gpio0 RK_PC2 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&ts_int>;
	};
};

&i2s0_8ch {
	status = "disabled";
	/* HDMI */
};

&i2s1_8ch {
	pinctrl-names = "default";
	pinctrl-0 = <&i2s1m0_sclktx
		     &i2s1m0_lrcktx
		     &i2s1m0_sdi0
		     &i2s1m0_sdo0>;
	rockchip,trcm-sync-tx-only;
	status = "okay";
	/* PMIC RK817 */
};

&i2s2_2ch {
	rockchip,trcm-sync-tx-only;
	#sound-dai-cells = <0>;
	status = "okay";
	/* UWE5621 Bluetooth */
};

&pinctrl {
	pmic {
		pmic_int_l: pmic-int {
			rockchip,pins = <0 RK_PA3 RK_FUNC_GPIO &pcfg_pull_up>;
		};
	};

	usb {
		vcc5v0_usb_host_en: vcc5v0-usb-host-en {
			rockchip,pins = <3 RK_PC0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	vcc_sd {
		vcc_sd_h: vcc-sd-h {
			rockchip,pins = <0 RK_PA5 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	lcd {
		lcd_rst: lcd-rst-gpio {
			rockchip,pins = <3 RK_PC3 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		lcd_en: lcd-enable-gpio {
			rockchip,pins = <3 RK_PB1 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	sdio-pwrseq {
		wifi_enable_h: wifi-enable-h {
			rockchip,pins = <0 RK_PC0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	vcc-wifi {
		vcc_wifi_h: vcc-wifi-h {
			rockchip,pins = <0 RK_PA0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	audio-amplifier {
		spk_amp_enable_h: spk-amp-enable-h {
			rockchip,pins =
				<3 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	hp-detect {
		hp_det: hp-det {
			rockchip,pins =
				<3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
	ts {
		ts_int: ts-int {
			rockchip,pins = <0 RK_PB0 RK_FUNC_GPIO &pcfg_pull_up>;
		};
	};

};

&pmu_io_domains {
    pmuio1-supply = <&vcc3v3_pmu>;
    pmuio2-supply = <&vcca1v8_pmu>;
    vccio1-supply = <&vccio_acodec>;
    #vccio2-supply = <&vcc_1v8>;
    vccio3-supply = <&vccio_sd>;
    vccio4-supply = <&vcc_1v8>;
    vccio5-supply = <&vcc_3v3>;
    vccio6-supply = <&vcc1v8_dvp>;
    vccio7-supply = <&vcc_3v3>;
    status = "okay";
};

&pwm14 {
	status = "okay";
};

&sdmmc0 { /* sd-card slot */
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	disable-wp;
	sd-uhs-sdr104;
	pinctrl-names = "default";
	pinctrl-0 = <&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd &sdmmc0_det>;
	vmmc-supply = <&vcc3v3_sd>;
	vqmmc-supply = <&vccio_sd>;
	status = "okay";
};

&sdmmc1 { /* sdio0 */
	/* WiFi & BT combo module Unisoc UWE5621DS */
	bus-width = <4>;
	cap-sd-highspeed;
	cap-sdio-irq;
	supports-sdio;
	disable-wp;
	keep-power-in-suspend;
	pinctrl-names = "default";
	vmmc-supply = <&vcc_wifi>;
	//max-frequency = <200000000>;
	pinctrl-0 = <&sdmmc1_bus4 &sdmmc1_cmd &sdmmc1_clk>;
	sd-uhs-sdr104;
	broken-cd;
	//mmc-pwrseq = <&sdio_pwrseq>;
	rockchip,default-sample-phase = <90>;
	status = "okay";
};

&sdhci {
    /* eMMC - mmc2 */
    bus-width = <8>;
    max-frequency = <200000000>;
    mmc-hs200-1_8v;
    non-removable;
    pinctrl-names = "default";
    pinctrl-0 = <&emmc_bus8 &emmc_clk &emmc_cmd &emmc_datastrobe>;
    
    /* 添加分区信息 */
    // mmc-ddr-1_8v;
    // mmc-hs400-1_8v;
    status = "okay";
};

&tsadc {
	status = "okay";
};

&saradc {
	vref-supply = <&vcc_1v8>;
	status = "okay";
};

&uart1 { /* UWE5622 Bluetooth or GNSS? */
	pinctrl-0 = <&uart1m0_ctsn>, <&uart1m0_rtsn>, <&uart1m0_xfer>;
	pinctrl-names = "default";
	uart-has-rtscts;
	dma-names = "tx", "rx";
	status = "disabled";
};

&uart2 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart2m0_xfer>;
};

&u2phy0_otg {
	status = "okay";
};

&usb2phy0 {
	status = "okay";
};

&usbdrd_dwc3 {
	status = "okay";
};

&usbdrd30 {
	status = "okay";
};

&u2phy1_host {
	vbus-supply = <&otg_switch>;
	status = "okay";
};

&usb2phy1 {
	status = "okay";
};

// &usb2phy0 {
// 	status = "okay";
// };

// &usb2phy1 {
// 	status = "okay";
// };

// &u2phy0_host {
// 	/* phy-supply = <&vcc5v0_usb_host>; */
// 	/* status = "okay"; */
// 	// status = "disabled";
// 	status = "okay";
// };

// &u2phy1_host {
// 	/* phy-supply = <&vcc5v0_usb_host>; */
// 	/* status = "okay"; */
// 	status = "disabled";
// 	// status = "okay";
// };

// &u2phy0_otg {
// 	// vbus-supply = <&otg_switch>;
// 	// status = "okay";
// 	status = "disabled";
// };

// &u2phy1_otg {
// 	vbus-supply = <&otg_switch>;
// 	status = "okay";
// 	// status = "disabled";
// };

// &usb_host0_ehci {
// 	/* dr_mode = "otg"; !!! */
// 	dr_mode = "host";
// 	phy-names = "usb1-phy";
// 	phys = <&u2phy0_host>;
// 	// extcon = <&usb2phy0>;
// 	status = "okay";
// };

// &usb_host1_ehci {
// 	dr_mode = "otg";
// 	phy-names = "usb2-phy";
// 	phys = <&u2phy0_host>;
// 	extcon = <&usb2phy1>;
// 	status = "okay";
// };

// &cru {
// 	assigned-clocks = <&cru PLL_GPLL>, <&pmucru PLL_PPLL>,
// 		<&cru PLL_VPLL>;
// 	assigned-clock-rates = <1200000000>, <200000000>,
// 		<216000000>;
// };

/* 启用 GPU */
&gpu {
    mali-supply = <&vdd_gpu>;
    status = "okay";
};

/* 确保显示系统正常工作 */
&vop {
    assigned-clocks = <&cru DCLK_VOP0>, <&cru DCLK_VOP1>;
    assigned-clock-parents = <&pmucru PLL_HPLL>, <&cru PLL_VPLL>;
    status = "okay";
};

&vop_mmu {
    status = "okay";
};

&route_dsi0 {
	status = "okay";
	connect = <&vp0_out_dsi0>;
};

&video_phy0 {
	status = "okay";
};

&dsi0_in_vp1 {
	status = "okay";
};

&dsi0_in_vp0 {
	status = "disabled";
};
